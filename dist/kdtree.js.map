{"version":3,"file":"kdtree.js","sources":["../src/binary_heap.js","../src/tree.js"],"sourcesContent":["/**\n * Binary heap implementation from:\n * http://eloquentjavascript.net/appendix2.html\n */\nexport default class BinaryHeap {\n\n  /**\n   * @constructor\n   * @param  {Function} scoreFunction\n   */\n  constructor(scoreFunction) {\n\n    /**\n     * @type {Array}\n     */\n    this.content = [];\n\n    /**\n     * @type {Function}\n     */\n    this.scoreFunction = scoreFunction;\n  }\n\n  /**\n   * @param  {*} element\n   */\n  push(element) {\n    // Add the new element to the end of the array.\n    this.content.push(element);\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1);\n  }\n\n  /**\n   * @return {*}\n   */\n  pop() {\n    let content = this.content;\n    // Store the first element so we can return it later.\n    let result = content[0];\n    // Get the element at the end of the array.\n    let end = content.pop();\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (content.length > 0) {\n      content[0] = end;\n      this.sinkDown(0);\n    }\n    return result;\n  }\n\n  /**\n   * Non-destructive\n   * @return {*}\n   */\n  peek() {\n    return this.content[0];\n  }\n\n  /**\n   * @param  {*} node\n   */\n  remove(node) {\n    const len = this.content.length;\n    const scoreFunction = this.scoreFunction;\n    const content = this.content;\n\n    // To remove a value, we must search through the array to find it.\n    for (let i = 0; i < len; i++) {\n      if (content[i] === node) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        let end = content.pop();\n        if (i !== len - 1) {\n          content[i] = end;\n          if (scoreFunction(end) < scoreFunction(node)) {\n            this.bubbleUp(i);\n          } else {\n            this.sinkDown(i);\n          }\n        }\n        return;\n      }\n    }\n    throw new Error(\"Node not found.\");\n  }\n\n  /**\n   * @return {Number}\n   */\n  size() {\n    return this.content.length;\n  }\n\n  /**\n   * @param  {Number} n\n   */\n  bubbleUp(n) {\n    const content = this.content;\n    const scoreFunction = this.scoreFunction;\n    // Fetch the element that has to be moved.\n    let element = content[n];\n\n\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      let parentN = Math.floor((n + 1) / 2) - 1;\n      let parent = content[parentN];\n\n      // Swap the elements if the parent is greater.\n      if (scoreFunction(element) < scoreFunction(parent)) {\n        content[parentN] = element;\n        content[n] = parent;\n        // Update 'n' to continue at the new position.\n        n = parentN;\n      }\n      // Found a parent that is less, no need to move it further.\n      else {\n        break;\n      }\n    }\n  }\n\n  /**\n   * @param  {Number} n\n   */\n  sinkDown(n) {\n    const content = this.content;\n    const scoreFunction = this.scoreFunction;\n    const length = content.length;\n\n    // Look up the target element and its score.\n    let element = content[n];\n    let elemScore = scoreFunction(element);\n\n    while (true) {\n      // Compute the indices of the child elements.\n      let child2N = (n + 1) * 2;\n      let child1N = child2N - 1;\n      // This is used to store the new position of the element,\n      // if any.\n      let swap = null;\n\n      let child1Score, child2Score;\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        child1Score = scoreFunction(content[child1N]);\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) {\n          swap = child1N;\n        }\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        child2Score = scoreFunction(this.content[child2N]);\n        if (child2Score < (swap === null ? elemScore : child1Score)) {\n          swap = child2N;\n        }\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap) {\n        content[n] = content[swap];\n        content[swap] = element;\n        n = swap;\n      } else break; // Otherwise, we are done.\n    }\n  }\n}\n","import BinaryHeap from './binary_heap';\n\nfunction createNode(data, dimension, parent = null) {\n  return {\n    data: data,\n\n    left: null,\n    right: null,\n    parent: parent,\n\n    dimension: dimension\n  };\n}\n\nexport default class KDTree {\n\n  constructor(points, metric, dimensions) {\n\n    /**\n     * @type {Array.<String>}\n     */\n    this.dimensions = dimensions;\n\n    /**\n     * @type {Function}\n     */\n    this.metric = metric;\n\n    // If points is not an array, assume we're loading a pre-built tree\n    if (!Array.isArray(points)) {\n      this.loadTree(points);\n    } else {\n\n      /**\n       * @type {Object}\n       */\n      this.root = this.buildTree(points, 0, null);\n    }\n\n\n  }\n\n  /**\n   * @param  {Array.<Object>} points\n   * @param  {Number}         depth\n   * @param  {Object=}        parent\n   * @return {Node}\n   */\n  buildTree(points, depth, parent) {\n    const dimensions = this.dimensions;\n    let dim = depth % dimensions.length;\n    let median, node;\n\n    if (points.length === 0) {\n      return null;\n    }\n\n    if (points.length === 1) {\n      return createNode(points[0], dim, parent);\n    }\n\n    points.sort(function(a, b) {\n      return a[dimensions[dim]] - b[dimensions[dim]];\n    });\n\n    median = Math.floor(points.length / 2);\n    node = createNode(points[median], dim, parent);\n\n    // divide\n    node.left = this.buildTree(points.slice(0, median), depth + 1, node);\n    node.right = this.buildTree(points.slice(median + 1), depth + 1, node);\n\n    return node;\n  }\n\n  /**\n   * Reloads a serialied tree by putting back `parent refs`\n   * @param  {Object=} data\n   */\n  loadTree(data) {\n    this.root = data;\n    KDTree.restoreParent(this.root);\n  }\n\n\n  static restoreParent(root) {\n    if (root.left) {\n      root.left.parent = root;\n      KDTree.restoreParent(root.left);\n    }\n\n    if (root.right) {\n      root.right.parent = root;\n      KDTree.restoreParent(root.right);\n    }\n  }\n\n  /**\n   * Convert to a JSON serializable structure;\n   * this just requires removing the `parent` property\n   *\n   * @param {Object=} src\n   */\n  toJSON(src) {\n    if (!src)\n      src = this.root;\n    let dest = createNode(src.data, src.dimension, null);\n    if (src.left) {\n      dest.left = this.toJSON(src.left);\n    }\n    if (src.right) {\n      dest.right = this.toJSON(src.right);\n    }\n    return dest;\n  }\n\n  innerSearch(point, node, parent) {\n    if (node === null) {\n      return parent;\n    }\n\n    let dimension = this.dimensions[node.dimension];\n    if (point[dimension] < node.data[dimension]) {\n      return this.innerSearch(point, node.left, node);\n    } else {\n      return this.innerSearch(point, node.right, node);\n    }\n  }\n\n  /**\n   * @param  {*}    point\n   * @return {Node}\n   */\n  insert(point) {\n    let insertPosition = this.innerSearch(point, this.root, null);\n    let dimensions = this.dimensions;\n\n    if (insertPosition === null) {\n      this.root = createNode(point, 0, null);\n      return this.root;\n    }\n\n    let newNode = createNode(point, (insertPosition.dimension + 1) % dimensions.length,\n      insertPosition);\n    let dimension = dimensions[insertPosition.dimension];\n\n    if (point[dimension] < insertPosition.data[dimension]) {\n      insertPosition.left = newNode;\n    } else {\n      insertPosition.right = newNode;\n    }\n\n    return newNode;\n  }\n\n  /**\n   * @param  {Node|Null} node\n   * @param  {*}         point\n   * @return {Node|Null}\n   */\n  nodeSearch(node, point) {\n    if (node === null) {\n      return null;\n    }\n\n    if (node.data === point) {\n      return node;\n    }\n\n    var dimension = this.dimensions[node.dimension];\n\n    if (point[dimension] < node.data[dimension]) {\n      return this.nodeSearch(node.left, node.data);\n    } else {\n      return this.nodeSearch(node.right, node.data);\n    }\n  }\n\n  /**\n   * @param  {Node}          node\n   * @param  {String|Number} dim\n   * @return {Node|Null}\n   */\n  findMin(node, dim) {\n    if (node === null) {\n      return null;\n    }\n\n    let dimension = this.dimensions[dim];\n\n    if (node.dimension === dim) {\n      if (node.left !== null) {\n        return this.findMin(node.left, dim);\n      }\n      return node;\n    }\n\n    let own = node.data[dimension];\n    let left = this.findMin(node.left, dim);\n    let right = this.findMin(node.right, dim);\n    let min = node;\n\n    if (left !== null && left.data[dimension] < own) {\n      min = left;\n    }\n\n    if (right !== null && right.data[dimension] < min.data[dimension]) {\n      min = right;\n    }\n    return min;\n  }\n\n  /**\n   * @param  {Node} node\n   */\n  removeNode(node) {\n    let nextNode, nextObj;\n\n    if (node.left === null && node.right === null) {\n      if (node.parent === null) {\n        this.root = null;\n        return;\n      }\n\n      let pDimension = dimensions[node.parent.dimension];\n\n      if (node.data[pDimension] < node.parent.data[pDimension]) {\n        node.parent.left = null;\n      } else {\n        node.parent.right = null;\n      }\n      return;\n    }\n\n    // If the right subtree is not empty, swap with the minimum element on the\n    // node's dimension. If it is empty, we swap the left and right subtrees and\n    // do the same.\n    if (node.right !== null) {\n      nextNode = this.findMin(node.right, node.dimension);\n      nextObj = nextNode.data;\n      this.removeNode(nextNode);\n      node.data = nextObj;\n    } else {\n      nextNode = this.findMin(node.left, node.dimension);\n      nextObj = nextNode.data;\n      this.removeNode(nextNode);\n      node.right = node.left;\n      node.left = null;\n      node.data = nextObj;\n    }\n  }\n\n  /**\n   * Find and remove node\n   * @param  {*} point\n   * @return {*}\n   */\n  remove(point) {\n    let node = this.nodeSearch(this.root, point);\n    if (node) {\n      this.removeNode(node);\n    }\n    return point;\n  }\n\n  /**\n   * @param  {Node}       node\n   * @param  {Number}     distance\n   * @param  {BinaryHeap} bestNodes\n   * @param  {Number}     maxNodes\n   */\n  static saveNode(node, distance, bestNodes, maxNodes) {\n    bestNodes.push([node, distance]);\n    if (bestNodes.size() > maxNodes) {\n      bestNodes.pop();\n    }\n  }\n\n  /**\n   * @param  {Node}       node\n   * @param  {*}          point\n   * @param  {BinaryHeap} bestNodes\n   * @param  {Number}     maxNodes\n   */\n  nearestSearch(node, point, bestNodes, maxNodes) {\n    var bestChild;\n    const dimensions = this.dimensions;\n    let dimension = dimensions[node.dimension];\n    let ownDistance = this.metric(point, node.data);\n    let linearPoint = {};\n    let otherChild, i;\n\n    for (let i = 0, len = dimensions.length; i < len; i++) {\n      if (i === node.dimension) {\n        linearPoint[dimensions[i]] = point[dimensions[i]];\n      } else {\n        linearPoint[dimensions[i]] = node.data[dimensions[i]];\n      }\n    }\n\n    let linearDistance = this.metric(linearPoint, node.data);\n\n    if (node.right === null && node.left === null) {\n      if (bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[1]) {\n        KDTree.saveNode(node, ownDistance, bestNodes, maxNodes);\n      }\n      return;\n    }\n\n    if (node.right === null) {\n      bestChild = node.left;\n    } else if (node.left === null) {\n      bestChild = node.right;\n    } else {\n      if (point[dimension] < node.data[dimension]) {\n        bestChild = node.left;\n      } else {\n        bestChild = node.right;\n      }\n    }\n\n    this.nearestSearch(bestChild, point, bestNodes, maxNodes);\n\n    if (bestNodes.size() < maxNodes ||\n      ownDistance < bestNodes.peek()[1]) {\n      KDTree.saveNode(node, ownDistance, bestNodes, maxNodes);\n    }\n\n    if (bestNodes.size() < maxNodes ||\n      Math.abs(linearDistance) < bestNodes.peek()[1]) {\n      if (bestChild === node.left) {\n        otherChild = node.right;\n      } else {\n        otherChild = node.left;\n      }\n      if (otherChild !== null) {\n        this.nearestSearch(otherChild, point, bestNodes, maxNodes);\n      }\n    }\n  }\n\n  /**\n   * @param  {*} point\n   * @param  {Number} maxNodes\n   * @param  {Number}\n   * @return {Array.<*>} [data, distance]\n   */\n  nearest(point, maxNodes = 1, maxDistance = 0) {\n    let bestNodes = new BinaryHeap((e) => -e[1]);\n\n    if (maxDistance) {\n      for (let i = 0; i < maxNodes; i++) {\n        bestNodes.push([null, maxDistance]);\n      }\n    }\n\n    if (this.root) {\n      this.nearestSearch(this.root, point, bestNodes, maxNodes);\n    }\n\n    let result = [];\n\n    for (let i = 0, len = Math.min(maxNodes, bestNodes.content.length); i < len; i++) {\n      if (bestNodes.content[i][0]) {\n        result.push([bestNodes.content[i][0].data, bestNodes.content[i][1]]);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @return {Number}\n   */\n  balanceFactor() {\n    function height(node) {\n      if (node === null) return 0;\n      return Math.max(height(node.left), height(node.right)) + 1;\n    }\n\n    function count(node) {\n      if (node === null) return 0;\n      return count(node.left) + count(node.right) + 1;\n    }\n\n    return height(this.root) / (Math.log(count(this.root)) / Math.log(2));\n  }\n\n}\n"],"names":["let","this","i"],"mappings":"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"}